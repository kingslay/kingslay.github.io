# **iOS11图片存储、下载方案**

## 一、前言

在iOS 11的发布会上，苹果推出了两种全新的媒体格式“HEVC和HEIF”：视频方面使用HEVC来代替H.264，而图片则是用HEIF来代替JPG。官方宣称压缩率相比之前最大可以小40%。

## 二、兼容问题

HEVC 和 HEIF 这两个新格式，需要配备A10 Fusion 及以上芯片的 iOS 设备（iPhone 7 Plus、iPhone 7、10.5 英寸 iPad Pro 和 2017 12.9 英寸 iPad Pro 及以上设备）才能进行编码；配备 A9 及以上芯片的 iOS 设备(iPhone 6s/6s Plus 及以上的设备)才能硬解码。

## 三、方案对比

### 1、方案1：把heif转为jpg进行存储和传输

存储格式/传输格式: jpg/jpg

优点：

- 只要iOS这边进行兼容修改就可以 
- 大部分的设备都支持jpg硬解码，解码速度快，省电  
- 腾讯云支持jpg

缺点：

- 压缩率不高，存储、传输成本大  

### 2、方案2: 直接上传HEIF格式的图片 

存储格式/传输格式: HEIF/HEIF

优点：

- HEIF的压缩率高，节约了带宽和存储空间
- 减少少数图片的上传时间
- 减少少数图片的下载时间

缺点：

- 需要android，iOS、h5增加HEIF解码（旧版本无法兼容） 
- 需要后端（腾讯云）支持heif存储和heif图片的裁剪  
- 目前只有iPhone7以上的设备才能进行硬解码。其他的设备只能用软解码。解码速度慢，比较耗电。  
- 现在支持HEVC的设备少，而且HEVC的专利费贵，不利于后续的推广  
- 目前只有iPhone7以上的设备才会有HEIF格式的图片，对前后台整体优化不大

### 3、方案3: 把HEIF转为jpg，jpg转为webp进行存储和传输  

存储格式/传输格式: webp/webp

优点：

- Webp的压缩率高，节约了上下行带宽和存储空间（目前还没有heif跟webp的压缩率对比。但是HEIF的压缩率应该是高于webp的。因为同样基于HEVC的BPG的压缩率高于webp）
- 减少图片上传时间
- 减少图片加载时间
- webp是开源免费 
- Android 4.0以上、Chrome浏览器原生支持  
- 腾讯云支持webp
- 新上传的图片都改成用webp。对前后台整体优化大

缺点：

- 需要iOS，h5增加webp的软解码(无法兼容旧版本)
- 目前只有部分设备支持硬解码。其他的设备只能用软解码。解码速度慢，比较耗电。  

#### 4、方案4: 把HEIF转为jpg，用jpg进行上传存储，下载用webp

存储格式/传输格式: jpg/webp

优点：

- Webp的压缩率高，节约下行的带宽
- 减少图片加载时间
- webp是开源免费 
- Android 4.0以上、Chrome浏览器原生支持  
- 腾讯云支持webp
- 可以根据请求url来控制是否要启用webp。所以兼容旧版本

缺点：

- 需要iOS，h5增加webp的软解码
- 目前只有部分设备支持硬解码。其他的设备只能用软解码。解码速度慢，比较耗电。 
- 只优化了图片的下载时间

## 四、总结

综合以上对比。个人感觉方案4比较好

- #### ​,,​,,​

